!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/common/http"),require("qs")):"function"==typeof define&&define.amd?define("nest-crud-typeorm-client",["exports","@angular/common/http","qs"],e):e((t=t||self)["nest-crud-typeorm-client"]={},t.ng.common.http,t.qs)}(this,(function(t,e,r){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};var n=function(){return(n=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};function o(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var i,n,o=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(i=o.next()).done;)s.push(i.value)}catch(t){n={error:t}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return s}function s(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(o(arguments[e]));return t}var a,u=function(t){function e(e){return t.call(this,e)||this}return function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),e}(Error),p=function(t){return Object.keys(t)},c=function(t){return void 0===t},h=function(t){return null===t},f=function(t){return c(t)||h(t)},l=function(t){return"string"==typeof t},y=function(t){return t.length>0},m=function(t){return l(t)&&y(t)},d=function(t){return Array.isArray(t)&&y(t)},g=function(t){return d(t)&&t.every((function(t){return m(t)}))},v=function(t){return"object"==typeof t&&!h(t)},O=function(t){return"number"==typeof t&&!Number.isNaN(t)&&Number.isFinite(t)},N=function(t,e){return t===e},b=function(t){return"boolean"==typeof t},P=function(t){return m(t)&&/^\d{4}-[01]\d-[0-3]\d(?:T[0-2]\d:[0-5]\d:[0-5]\d(?:\.\d+)?(?:Z|[-+][0-2]\d(?::?[0-5]\d)?)?)?$/g.test(t)},j=function(t){return t instanceof Date},_=function(t){return m(t)||O(t)||b(t)||j(t)},S=function(t){return d(t)?t.every((function(t){return _(t)})):_(t)};(a=t.CondOperator||(t.CondOperator={})).EQUALS="$eq",a.NOT_EQUALS="$ne",a.GREATER_THAN="$gt",a.LOWER_THAN="$lt",a.GREATER_THAN_EQUALS="$gte",a.LOWER_THAN_EQUALS="$lte",a.STARTS="$starts",a.ENDS="$ends",a.CONTAINS="$cont",a.EXCLUDES="$excl",a.IN="$in",a.NOT_IN="$notin",a.IS_NULL="$isnull",a.NOT_NULL="$notnull",a.BETWEEN="$between",a.EQUALS_LOW="$eqL",a.NOT_EQUALS_LOW="$neL",a.STARTS_LOW="$startsL",a.ENDS_LOW="$endsL",a.CONTAINS_LOW="$contL",a.EXCLUDES_LOW="$exclL",a.IN_LOW="$inL",a.NOT_IN_LOW="$notinL";var w=Object.assign(["eq","ne","gt","lt","gte","lte","starts","ends","cont","excl","in","notin","isnull","notnull","between"],p(t.CondOperator).map((function(e){return t.CondOperator[e]}))),A=["ASC","DESC"],L=w.join(),q=A.join();function $(t,e){if(!v(t)||!m(t.field))throw new u("Invalid field type in "+e+" condition. String expected");!function(t){if(!w.includes(t))throw new u("Invalid comparison operator. "+L+" expected")}(t.operator)}function Q(t){if(!v(t)||!m(t.field))throw new u("Invalid join field. String expected");if(!c(t.select)&&!g(t.select))throw new u("Invalid join select. Array of strings expected")}function E(t){if(!v(t)||!m(t.field))throw new u("Invalid sort field. String expected");if(!N(t.order,A[0])&&!N(t.order,A[1]))throw new u("Invalid sort order. "+q+" expected")}function T(t,e){if(!O(t))throw new u("Invalid "+e+". Number expected")}var U=function(){function t(){this.paramNames={},this.queryObject={},this.setParamNames()}return t.setOptions=function(e){t._options=n(n(n({},t._options),e),{paramNamesMap:n(n({},t._options.paramNamesMap),e.paramNamesMap?e.paramNamesMap:{})})},t.getOptions=function(){return t._options},t.create=function(e){var r=new t;return v(e)?r.createFromParams(e):r},Object.defineProperty(t.prototype,"options",{get:function(){return t._options},enumerable:!0,configurable:!0}),t.prototype.setParamNames=function(){var e=this;Object.keys(t._options.paramNamesMap).forEach((function(r){var i=t._options.paramNamesMap[r];e.paramNames[r]=l(i)?i:i[0]}))},t.prototype.query=function(t){return void 0===t&&(t=!0),this.queryObject[this.paramNames.search]&&(this.queryObject[this.paramNames.filter]=void 0,this.queryObject[this.paramNames.or]=void 0),this.queryString=r.stringify(this.queryObject,{encode:t}),this.queryString},t.prototype.select=function(t){return d(t)&&(!function(t){if(!g(t))throw new u("Invalid fields. Array of strings expected")}(t),this.queryObject[this.paramNames.fields]=t.join(this.options.delimStr)),this},t.prototype.search=function(t){return!f(t)&&v(t)&&(this.queryObject[this.paramNames.search]=JSON.stringify(t)),this},t.prototype.setFilter=function(t){return this.setCondition(t,"filter"),this},t.prototype.setOr=function(t){return this.setCondition(t,"or"),this},t.prototype.setJoin=function(t){var e=this;if(!f(t)){var r=this.checkQueryObjectParam("join",[]);this.queryObject[r]=s(this.queryObject[r],Array.isArray(t)&&!l(t[0])?t.map((function(t){return e.addJoin(t)})):[this.addJoin(t)])}return this},t.prototype.sortBy=function(t){var e=this;if(!f(t)){var r=this.checkQueryObjectParam("sort",[]);this.queryObject[r]=s(this.queryObject[r],Array.isArray(t)&&!l(t[0])?t.map((function(t){return e.addSortBy(t)})):[this.addSortBy(t)])}return this},t.prototype.setLimit=function(t){return this.setNumeric(t,"limit"),this},t.prototype.setOffset=function(t){return this.setNumeric(t,"offset"),this},t.prototype.setPage=function(t){return this.setNumeric(t,"page"),this},t.prototype.resetCache=function(){return this.setNumeric(0,"cache"),this},t.prototype.cond=function(t,e){void 0===e&&(e="search");var r=Array.isArray(t)?{field:t[0],operator:t[1],value:t[2]}:t;$(r,e);var i=this.options.delim;return r.field+i+r.operator+(S(r.value)?i+r.value:"")},t.prototype.addJoin=function(t){var e=Array.isArray(t)?{field:t[0],select:t[1]}:t;Q(e);var r=this.options.delim,i=this.options.delimStr;return e.field+(d(e.select)?r+e.select.join(i):"")},t.prototype.addSortBy=function(t){var e=Array.isArray(t)?{field:t[0],order:t[1]}:t;E(e);var r=this.options.delimStr;return e.field+r+e.order},t.prototype.createFromParams=function(t){return this.select(t.fields),this.search(t.search),this.setFilter(t.filter),this.setOr(t.or),this.setJoin(t.join),this.setLimit(t.limit),this.setOffset(t.offset),this.setPage(t.page),this.sortBy(t.sort),t.resetCache&&this.resetCache(),this},t.prototype.checkQueryObjectParam=function(t,e){var r=this.paramNames[t];return f(this.queryObject[r])&&!c(e)&&(this.queryObject[r]=e),r},t.prototype.setCondition=function(t,e){var r=this;if(!f(t)){var i=this.checkQueryObjectParam(e,[]);this.queryObject[i]=s(this.queryObject[i],Array.isArray(t)&&!l(t[0])?t.map((function(t){return r.cond(t,e)})):[this.cond(t,e)])}},t.prototype.setNumeric=function(t,e){f(t)||(T(t,e),this.queryObject[this.paramNames[e]]=t)},t._options={delim:"||",delimStr:",",paramNamesMap:{fields:["fields","select"],search:"s",filter:"filter",or:"or",join:"join",sort:"sort",limit:["limit","per_page"],offset:"offset",page:"page",cache:"cache"}},t}(),I=function(){function t(){this.fields=[],this.paramsFilter=[],this.authPersist=void 0,this.filter=[],this.or=[],this.join=[],this.sort=[]}return Object.defineProperty(t.prototype,"_options",{get:function(){return U.getOptions()},enumerable:!0,configurable:!0}),t.create=function(){return new t},t.prototype.getParsed=function(){return{fields:this.fields,paramsFilter:this.paramsFilter,authPersist:this.authPersist,search:this.search,filter:this.filter,or:this.or,join:this.join,sort:this.sort,limit:this.limit,offset:this.offset,page:this.page,cache:this.cache}},t.prototype.parseQuery=function(t){if(v(t)){var e=p(t);if(y(e)){this._query=t,this._paramNames=e;var r=this._query[this.getParamNames("search")[0]];this.search=this.parseSearchQueryParam(r),f(this.search)&&(this.filter=this.parseQueryParam("filter",this.conditionParser.bind(this,"filter")),this.or=this.parseQueryParam("or",this.conditionParser.bind(this,"or"))),this.fields=this.parseQueryParam("fields",this.fieldsParser.bind(this))[0]||[],this.join=this.parseQueryParam("join",this.joinParser.bind(this)),this.sort=this.parseQueryParam("sort",this.sortParser.bind(this)),this.limit=this.parseQueryParam("limit",this.numericParser.bind(this,"limit"))[0],this.offset=this.parseQueryParam("offset",this.numericParser.bind(this,"offset"))[0],this.page=this.parseQueryParam("page",this.numericParser.bind(this,"page"))[0],this.cache=this.parseQueryParam("cache",this.numericParser.bind(this,"cache"))[0]}}return this},t.prototype.parseParams=function(t,e){var r=this;if(v(t)){var i=p(t);y(i)&&(this._params=t,this._paramsOptions=e,this.paramsFilter=i.map((function(t){return r.paramParser(t)})).filter((function(t){return t})))}return this},t.prototype.setAuthPersist=function(t){void 0===t&&(t={}),this.authPersist=t||{}},t.prototype.convertFilterToSearch=function(t){var e,r,i={isnull:!0,notnull:!0};return t?((e={})[t.field]=((r={})[t.operator]=i[t.operator]?i[t.operator]:t.value,r),e):{}},t.prototype.getParamNames=function(t){var e=this;return this._paramNames.filter((function(r){var i=e._options.paramNamesMap[t];return l(i)?i===r:i.some((function(t){return t===r}))}))},t.prototype.getParamValues=function(t,e){return m(t)?[e.call(this,t)]:d(t)?t.map((function(t){return e(t)})):[]},t.prototype.parseQueryParam=function(t,e){var r=this,i=this.getParamNames(t);return d(i)?i.reduce((function(t,i){return Object.assign(t,r.getParamValues(r._query[i],e))}),[]):[]},t.prototype.parseValue=function(t){try{var e=JSON.parse(t);return!j(e)&&v(e)||"number"==typeof e&&e.toLocaleString("fullwide",{useGrouping:!1})!==t?t:e}catch(e){return P(t)?new Date(t):t}},t.prototype.parseValues=function(t){var e=this;return d(t)?t.map((function(t){return e.parseValue(t)})):this.parseValue(t)},t.prototype.fieldsParser=function(t){return t.split(this._options.delimStr)},t.prototype.parseSearchQueryParam=function(t){try{if(f(t))return;var e=JSON.parse(t);if(!v(e))throw new Error;return e}catch(t){throw new u("Invalid search param. JSON expected")}},t.prototype.conditionParser=function(t,e){var r=e.split(this._options.delim),i=r[0],n=r[1],o=r[2]||"";if(["in","notin","between","$in","$notin","$between","$inL","$notinL"].some((function(t){return t===n}))&&(o=o.split(this._options.delimStr)),o=this.parseValues(o),!["isnull","notnull","$isnull","$notnull"].some((function(t){return t===n}))&&!S(o))throw new u("Invalid "+t+" value");var s={field:i,operator:n,value:o};return $(s,t),s},t.prototype.joinParser=function(t){var e=t.split(this._options.delim),r={field:e[0],select:m(e[1])?e[1].split(this._options.delimStr):void 0};return Q(r),r},t.prototype.sortParser=function(t){var e=t.split(this._options.delimStr),r={field:e[0],order:e[1]};return E(r),r},t.prototype.numericParser=function(t,e){var r=this.parseValue(e);return T(r,t),r},t.prototype.paramParser=function(t){!function(t,e){if(!v(t))throw new u("Invalid param "+e+". Invalid crud options");var r=t[e];if((!r||!r.disabled)&&(!v(r)||f(r.field)||f(r.type)))throw new u("Invalid param option in Crud")}(this._paramsOptions,t);var e=this._paramsOptions[t];if(!e.disabled){var r=this._params[t];switch(e.type){case"number":T(r=this.parseValue(r),"param "+t);break;case"uuid":!function(t,e){if(!/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(t)&&!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(t))throw new u("Invalid param "+e+". UUID string expected")}(r,t)}return{field:e.field,operator:"$eq",value:r}}},t}(),C=function(){function t(t,e){this.http=e,this.options=t}return t.prototype.getPagination=function(t,e,r){return r?r instanceof U||(r=U.create(r)):r=U.create(),r.setLimit(t),r.setPage(e),this.http.get(this.getBaseUrl(),{params:this.getParamsFromQuery(r)})},t.prototype.getMany=function(t){return this.http.get(this.getBaseUrl(),{params:this.getParamsFromQuery(t)})},t.prototype.getOne=function(t,e){var r=this.getOneUrl(t);return this.http.get(r,{params:this.getParamsFromQuery(e)})},t.prototype.create=function(t){return this.http.post(this.getBaseUrl(),JSON.stringify(t),{headers:{"Content-Type":"application/json"}})},t.prototype.createMany=function(t){return this.http.post(this.getBaseUrl()+"/bulk",JSON.stringify({bulk:t}),{headers:{"Content-Type":"application/json"}})},t.prototype.put=function(t,e){var r=this.getOneUrl(t);return this.http.put(r,JSON.stringify(e),{headers:{"Content-Type":"application/json"}})},t.prototype.patch=function(t,e){var r=this.getOneUrl(t);return this.http.patch(r,JSON.stringify(e),{headers:{"Content-Type":"application/json"}})},t.prototype.delete=function(t){var e=this.getOneUrl(t);return this.http.delete(e)},t.prototype.getParamsFromQuery=function(t){return t instanceof U||(t=U.create(t)),new e.HttpParams({fromString:this.getQuery(t)})},t.prototype.getBaseUrl=function(){return this.options.apiUrl+"/"+this.options.entity},t.prototype.getOneUrl=function(t){return this.getBaseUrl()+"/"+t},t.prototype.getQuery=function(t){return t?t.query():""},t}();t.CrudBaseService=C,t.RequestQueryBuilder=U,t.RequestQueryException=u,t.RequestQueryParser=I,t.getOwnPropNames=function(t){return Object.getOwnPropertyNames(t)},t.hasLength=y,t.hasValue=S,t.isArrayFull=d,t.isArrayStrings=g,t.isBoolean=b,t.isDate=j,t.isDateString=P,t.isEqual=N,t.isFalse=function(t){return!1===t},t.isFunction=function(t){return"function"==typeof t},t.isIn=function(t,e){return void 0===e&&(e=[]),e.some((function(e){return N(t,e)}))},t.isNil=f,t.isNull=h,t.isNumber=O,t.isNumeric=function(t){return/^[+-]?([0-9]*[.])?[0-9]+$/.test(t)},t.isObject=v,t.isObjectFull=function(t){return v(t)&&y(p(t))},t.isString=l,t.isStringFull=m,t.isTrue=function(t){return!0===t},t.isUndefined=c,t.isValue=_,t.objKeys=p,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=nest-crud-typeorm-client.umd.min.js.map